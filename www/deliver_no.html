<!doctype html>
<html class="">
<head>
<meta charset="utf-8">
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<title>דואר ישראל</title>
<link href="css/boilerplate.css" rel="stylesheet" type="text/css">
<link href="css/style.css" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Arimo:400,700' rel='stylesheet' type='text/css'>
 <link rel="stylesheet" href="js/css/jquery.sidr.dark.css">
 <script src="js/jquery.js"></script>
 <script src="js/jquery.sidr.min.js"></script>
  <script>
$(function(){
  $("#header").load("header.html");
  $("#footer").load("footer.html");
});
</script>
</head>
<body class="home">
<div id="header"></div>
<!--Content-->
<script>
		$(document).ready(function(){
			$(".mainContent").css("height", window.innerHeight-($("#header").innerHeight()+160));
		});
		</script>
<div class="mainContent">
	<div class="deliverBarcodeTitle">ברקוד</div>
<div class="BarcodeFields">
<form id="no_deliver">
   <select class="area" name="area" id="noReportReasonsList"></select>
    <input type="text" class="packageinput" name="packageNum" id="packageNum" maxlength="13" placeholder="הקלד מספר דבר דואר"><br>
<div class="greyText">* במידה והברקוד אינו קריא ניתן להקליד מספר דבר הדואר</div>
  <input type="radio" id="checkbox1" name="checkbox1" value="with phone" checked />
  <label for="checkbox1">עם מספר טלפון</label>
  <br>
  <input type="radio" id="checkbox2" name="checkbox2" value="without phone" />
  <label for="checkbox2">ללא מספר טלפון</label>
  </form>
</div>
<a href="#"><div class="BarcodeArea" id="deliver_no_startScan"></div></a>
<div class="loginBtn" id="submit"><a href="#">עדכן</a></div>
</div>
<!--Footer-->
<div id="footer"></div>
<script type="text/javascript">
	console.log('in deliver_no');
		$('#deliver_no_startScan').
			click(
			  function(){				
				//document.addEventListener("backbutton", onBackKeyDownOnScan, false);
				cordova.plugins.barcodeScanner.scan(
					function (result) {			
						var s =
						"Result: " + result.text + ", " +
						"Format: " + result.format + ", " +
						"Cancelled: " + result.cancelled;
						console.log(s);	
						if (!(result.cancelled)) {			
							//var resultDiv=document.getElementById("packageNum");			
							//resultDiv.innerHTML = result.text;
							$('input.packageNum').val(result.text);
							localStorage.setItem("delivery_no_result", result.text);
							} else {
								// user has cancelled the scan - nothing to do or display	
							}		
						//document.removeEventListener("backbutton", onBackKeyDownOnScan, false);									
					}, 					
				 	function(error) {
				 	//document.removeEventListener("backbutton", onBackKeyDownOnScan, false);
				 		console.log("Scanning failed: " + error);
						navigator.notification.alert(							
							'סליחה, המצלמה נתקלה בבעיה. ייתכן שיהיה עליך להפעיל מחדש את המכשיר',				//message
							null,														//callback
							'דוורים',														//title
							'אישור'														//button name
						);
					}
			)
	});
  
  $('#submit').
			click(
				function() {
					var delivery_no_result=localStorage.getItem("delivery_no_result");	
          if (delivery_no_result.length==13) {
            var withPhone = $('form input[type=radio]:checked').val();
            console.log('withPhone= '+withPhone);
            if (withPhone=="with phone") {
						    window.location = 'not_deliver_details.html';
            } else {
                var lastName=""; var firstName=""; var phoneNumber=""; var city=""; var street=""; var houseNumber=""; var sigBase64="";
                var username=localStorage.getItem("username");
                var heker=localStorage.getItem("heker");
                var barcodes=localStorage.getItem("delivery_no_result");
                var region=localStorage.getItem("region");
                var subRegion=localStorage.getItem("subRegion");
                var actionCode='4';     
                var actionDetailedCode=$("#noReportReasonsList").val();            
                insertBarcode(username, heker, region, subRegion, actionCode, actionDetailedCode, barcodes, firstName, lastName, city, street, streetText, houseNumber, sigBase64, phoneNumber);        
            }
					} else
					{
						navigator.notification.alert(
							'עליך לסרוק ברקוד או להקליד ידנית',    //message
							null,									//callback
							'דואר רשום',							//title
							'אישור'									//button name
						);
					}
				}
			) 
      
		//populate no deliver reason select box
		$(document).ready(function() {		
		$.getJSON("json/e-mesira.json", function(data){
			var listItems='<option value="0">-בחר-</option>';
			for (var i=0; i<data.length; i++) {
				listItems+= "<option value='" + data[i].code + "'>" + data[i].description + "</option>";
			}
		$("#noReportReasonsList").html(listItems);
		console.log("No Report Reasons List populated");
		}).fail(function(err){
			console.log("Error JSON = "+JSON.parse(err));
		});								
	});		        
  </script>
  </body>
</html>